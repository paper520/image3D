/*!
* image3D - üçä ‰ΩøÁî®webGLÁªòÂà∂‰∏âÁª¥ÂõæÁâá„ÄÇDrawing three-dimensional images using webGL.
* git+https://github.com/yelloxing/image3D.git
*
* author ÂøÉÂè∂
*
* version 1.0.2-alpha
*
* build Thu Apr 11 2019
*
* Copyright yelloxing
* Released under the MIT license
*
* Date:Sun Dec 01 2019 12:19:21 GMT+0800 (GMT+08:00)
*/

"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol==="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r};(function(){"use strict";var u=function r(t,e,n){var o=t.createShader(e);if(o==null)throw new Error("Unable to create shader!");t.shaderSource(o,n);t.compileShader(o);if(!t.getShaderParameter(o,t.COMPILE_STATUS))throw new Error("Failed to compile shader:"+t.getShaderInfoLog(o));return o};var o=function r(t,e,n){var o=u(t,t.VERTEX_SHADER,e),i=u(t,t.FRAGMENT_SHADER,n);var a=t.createProgram();t.attachShader(a,o);t.attachShader(a,i);t.linkProgram(a);if(!t.getProgramParameter(a,t.LINK_STATUS))throw new Error("Failed to link program: "+t.getProgramInfoLog(a));t.useProgram(a);return a};var t=function r(t,e){var n=t.createBuffer(),o=e?t.ELEMENT_ARRAY_BUFFER:t.ARRAY_BUFFER;t.bindBuffer(o,n);return n};var i=function r(t,e,n,o){var i=o?t.ELEMENT_ARRAY_BUFFER:t.ARRAY_BUFFER;t.bufferData(i,e,n)};var l=function r(t,e,n,o,i,a,u){t.vertexAttribPointer(e,n,o,u||false,i||0,a||0);t.enableVertexAttribArray(e)};var e=function r(t,e,n){var o=t.createTexture();t.activeTexture(t["TEXTURE"+e]);t.bindTexture(n,o);return o};var f=function r(t,e,n){var o=void 0;for(o in n){t.texParameteri(e,t[o],t[n[o]])}};var c=function r(t,e,n,o,i,a){t.texImage2D(e,n,o,o,i,a)};function a(r){var t=typeof r==="undefined"?"undefined":_typeof(r);return r!=null&&(t==="object"||t==="function")}var p=function r(t,e){var n=["webgl","experimental-webgl","webkit-3d","moz-webgl"],o=null,i=void 0;for(i=0;i<n.length;i++){try{o=t.getContext(n[i],e)}catch(r){}if(o)break}return o};var n=function r(t){return new r.prototype.init(t)};n.prototype.init=function(r){this[0]=r;return this};n.prototype.extend=n.extend=function(){var r=arguments[0]||{};var t=arguments[1]||{};var e=arguments.length;if(e===1){t=r;r=this}if(!a(r)){r={}}for(var n in t){try{r[n]=t[n]}catch(r){throw new Error("Illegal property valueÔºÅ")}}return r};n.prototype.init.prototype=n.prototype;n.prototype.render3D=function(r){var v=p(this[0],r),n={painter:function r(){return v},shader:function r(t,e){v.program=o(v,t,e);return n},buffer:function r(n){var r=t(v,n),f=void 0,c={write:function r(t,e){e=e||v.STATIC_DRAW;i(v,t,e,n);f=t;return c},use:function r(t,e,n,o,i,a){var u=f.BYTES_PER_ELEMENT;if(typeof t=="string")t=v.getAttribLocation(v.program,t);n=n||0;o=o||0;i=i||v.FLOAT;l(v,t,e,i,n*u,o*u,a);return c}};return c},texture:function r(t,i){i=i||v.TEXTURE_2D;var r=e(v,t,i);var a={config:function r(t){f(v,i,t);return a},use:function r(t,e,n,o){c(v,i,t,e,n,o);return a}};return a}};return n};function d(r,t,e,n){n=n||0;var o=Math.sqrt(t*t+e*e+n*n);return[1,0,0,0,0,1,0,0,0,0,1,0,t*r/o,e*r/o,n*r/o,1]}function m(r){var t=Math.sin(r),e=Math.cos(r);return[e,t,0,0,-t,e,0,0,0,0,1,0,0,0,0,1]}function y(r,t,e,n,o,i){n=n||0;o=o||0;i=i||0;return[r,0,0,0,0,t,0,0,0,0,e,0,n-n*r,o-o*t,i-i*e,1]}function s(r,t,e,n,o,i){if(typeof r==="number"&&typeof t==="number"){if(typeof e!=="number"){e=0;n=r;o=t;i=1}else if(typeof n!=="number"||typeof o!=="number"||typeof i!=="number"){n=r;o=t;i=e;r=0;t=0;e=0}if(r==n&&t==o&&e==i)throw new Error("It's not a legitimate ray!");var a=Math.sqrt((n-r)*(n-r)+(o-t)*(o-t)),u=a!=0?(o-t)/a:1,f=a!=0?(n-r)/a:0,c=(n-r)*f+(o-t)*u,v=i-e,l=Math.sqrt(c*c+v*v),p=l!=0?v/l:1,d=l!=0?c/l:0;return[[u,p*f,f*d,0,-f,u*p,u*d,0,0,-d,p,0,t*f-r*u,e*d-r*f*p-t*u*p,-r*f*d-t*u*d-e*p,1],[u,-f,0,0,p*f,p*u,-d,0,f*d,u*d,p,0,r,t,e,1]]}else{throw new Error("a1 and b1 is required!")}}var w=function r(t,e){var n=[];for(var o=0;o<4;o++){for(var i=0;i<e.length/4;i++){n[i*4+o]=t[o]*e[i*4]+t[o+4]*e[i*4+1]+t[o+8]*e[i*4+2]+t[o+12]*e[i*4+3]}}return n};function v(r){var c=r||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var v={move:function r(t,e,n,o){c=w(d(t,e,n,o),c);return v},rotate:function r(t,e,n,o,i,a,u){var f=s(e,n,o,i,a,u);c=w(w(w(f[1],m(t)),f[0]),c);return v},scale:function r(t,e,n,o,i,a){c=w(y(t,e,n,o,i,a),c);return v},multiply:function r(t,e){c=e?w(c,t):w(t,c);return v},use:function r(t,e,n,o){n=n||0;o=o||1;var i=w(c,[t,e,n,o]);i[0]=+i[0].toFixed(7);i[1]=+i[1].toFixed(7);i[2]=+i[2].toFixed(7);i[3]=+i[3].toFixed(7);return i},value:function r(){return c}};return v}function r(r){var t=v(r);return{value:t.value,rotate:t.rotate,scale:t.scale,move:t.move}}n.extend({transform:r});n.prototype.extend({});n.fn=n.prototype;if((typeof module==="undefined"?"undefined":_typeof(module))==="object"&&_typeof(module.exports)==="object"){module.exports=n}else{var h=window.image3D,b=window.$$;n.noConflict=function(r){if(window.$$===n){window.$$=b}if(r&&window.image3D===n){window.image3D=h}return n};window.image3D=window.$$=n}})();